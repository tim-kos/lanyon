{"version":3,"sources":["../src/utils.js"],"names":["require","semver","fs","path","_","yaml","shell","spawnSync","oneLine","stripIndent","scrolex","persistOpts","announce","addCommandAsComponent","main","module","failure","process","exit","utils","exports","preferLocalPackage","args","filename","appDir","name","entry","version","localModulePackage","absoluteEntry","realpathSync","e","type","exe","shift","i","stdio","dockerCmd","cmd","flags","cacheDir","projectDir","lanyonVersion","runhooks","order","cmdName","runtime","arr","collectStdout","hook","lastPart","split","pop","needEnv","lanyonEnv","squashedHooks","isArray","join","cwd","mode","env","SCROLEX_MODE","upwardDirContaining","find","not","PWD","parts","length","newParts","ppath","existsSync","undefined","basename","dirname","initProject","assetsBuildDir","gitRoot","binDir","mkdir","exec","relative","fsCopySync","src","dst","encoding","writeFileSync","readFileSync","writeConfig","cfg","lanyonDir","safeDump","jekyll","console","error","Error","message","JSON","stringify","nodemon","recordsPath","dBuf","gBuf","gems","satisfied","app","checkOn","prerequisites","rubyProvidersSkip","tag","indexOf","range","p","appVersionFull","stdout","trim","stderr","replace","appVersion","satisfies","stick"],"mappings":"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","file":"utils.js","sourcesContent":["require('babel-polyfill')\nconst semver      = require('semver')\nconst fs          = require('fs')\n// const _        = require('lodash')\nconst path        = require('path')\nconst _           = require('lodash')\nconst yaml        = require('js-yaml')\nconst shell       = require('shelljs')\nconst spawnSync   = require('spawn-sync')\nconst oneLine     = require('common-tags/lib/oneLine')\nconst stripIndent = require('common-tags/lib/stripIndent')\nconst scrolex     = require('scrolex').persistOpts({\n  announce             : true,\n  addCommandAsComponent: true,\n})\n\nif (require.main === module) {\n  scrolex.failure(`Please only used this module via require`)\n  process.exit(1)\n}\n\nconst utils = module.exports\n\nmodule.exports.preferLocalPackage = (args, filename, appDir, name, entry, version) => {\n  let localModulePackage\n  let absoluteEntry\n  try {\n    localModulePackage = require(`${appDir}/node_modules/${name}/package.json`)\n    absoluteEntry      = fs.realpathSync(`${appDir}/node_modules/${name}/${entry}`)\n  } catch (e) {\n    localModulePackage = {}\n    absoluteEntry      = false\n  }\n\n  if (localModulePackage.version && absoluteEntry) {\n    if (filename === absoluteEntry) {\n      return { type: 'symlinked', version: localModulePackage.version }\n    } else {\n      // We're entering globally and replacing this with a local instance\n      const exe = args.shift()\n      for (const i in args) {\n        // Replace the current entry, e.g. /usr/local/frey/lib/cli.js with the local package\n        if (args[i] === filename) {\n          args[i] = absoluteEntry\n        }\n      }\n      spawnSync(exe, args, { stdio: 'inherit' })\n      process.exit(0)\n      // return { type: 'local', version: localModulePackage.version }\n    }\n  } else {\n    return { type: 'local', version: version }\n  }\n}\n\nmodule.exports.dockerCmd = ({cacheDir, projectDir, lanyonVersion}, cmd, flags) => {\n  if (!flags) {\n    flags = ''\n  }\n  return oneLine`\n    docker run\n      ${flags}\n      --rm\n      --workdir ${cacheDir}\n      --user $(id -u)\n      --volume ${cacheDir}:${cacheDir}\n      --volume ${projectDir}:${projectDir}\n    kevinvz/lanyon:${lanyonVersion}\n    ${cmd}\n  `\n}\n\nmodule.exports.runhooks = async (order, cmdName, runtime) => {\n  let arr = []\n\n  arr = [\n    `${order}${cmdName}`,\n    `${order}${cmdName}:production`,\n    `${order}${cmdName}:development`,\n  ]\n\n  const collectStdout = {}\n  for (let i in arr) {\n    let hook = arr[i]\n    if (runtime[hook]) {\n      const lastPart = hook.split(':').pop()\n      let needEnv    = 'both'\n\n      if (lastPart === 'production') {\n        needEnv = lastPart\n      }\n      if (lastPart === 'development') {\n        needEnv = lastPart\n      }\n\n      if (needEnv === 'both' || runtime.lanyonEnv === needEnv) {\n        let squashedHooks = runtime[hook]\n        if (_.isArray(runtime[hook])) {\n          squashedHooks = runtime[hook].join(' && ')\n        }\n        collectStdout[hook] = await scrolex.exe(squashedHooks, {\n          cwd : runtime.projectDir,\n          mode: (process.env.SCROLEX_MODE || 'singlescroll'),\n        })\n      }\n    }\n  }\n\n  return collectStdout\n}\n\nmodule.exports.upwardDirContaining = (find, cwd, not) => {\n  if (!cwd) {\n    cwd = process.env.PWD || process.cwd()\n  }\n  const parts = cwd.split('/')\n  while (parts.length) {\n    const newParts = parts\n    const ppath = `${newParts.join('/')}/${find}`\n    if (fs.existsSync(ppath)) {\n      if (not === undefined || not !== path.basename(path.dirname(ppath))) {\n        return path.dirname(ppath)\n      }\n    }\n    parts.pop()\n  }\n  return false\n}\n\nmodule.exports.initProject = ({assetsBuildDir, gitRoot, cacheDir, binDir}) => {\n  if (!fs.existsSync(assetsBuildDir)) {\n    shell.mkdir('-p', assetsBuildDir)\n    shell.exec(`cd \"${path.dirname(gitRoot)}\" && git ignore \"${path.relative(gitRoot, assetsBuildDir)}\"`)\n  }\n  if (!fs.existsSync(cacheDir)) {\n    shell.mkdir('-p', cacheDir)\n    shell.exec(`cd \"${path.dirname(gitRoot)}\" && git ignore \"${path.relative(gitRoot, cacheDir)}\"`)\n  }\n  if (!fs.existsSync(binDir)) {\n    shell.mkdir('-p', binDir)\n    shell.exec(`cd \"${path.dirname(gitRoot)}\" && git ignore \"${path.relative(gitRoot, binDir)}\"`)\n  }\n}\n\nmodule.exports.fsCopySync = (src, dst, { mode = '644', encoding = 'utf-8' } = {}) => {\n  fs.writeFileSync(`${dst}`, fs.readFileSync(`${src}`, 'utf-8'), { mode, encoding })\n}\n\nmodule.exports.writeConfig = (cfg) => {\n  if (!fs.existsSync(`${cfg.runtime.cacheDir}/jekyll.lanyon_assets.yml`)) {\n    fs.writeFileSync(`${cfg.runtime.cacheDir}/jekyll.lanyon_assets.yml`, '# this file should be overwritten by the Webpack AssetsPlugin', 'utf-8')\n  }\n  utils.fsCopySync(`${cfg.runtime.lanyonDir}/Gemfile.lock`, `${cfg.runtime.cacheDir}/Gemfile.lock`)\n  try {\n    fs.writeFileSync(`${cfg.runtime.cacheDir}/jekyll.config.yml`, yaml.safeDump(cfg.jekyll), 'utf-8')\n  } catch (e) {\n    console.error({jekyll: cfg.jekyll})\n    throw new Error(`Unable to write above config to ${cfg.runtime.cacheDir}/jekyll.config.yml. ${e.message}`)\n  }\n  fs.writeFileSync(`${cfg.runtime.cacheDir}/nodemon.config.json`, JSON.stringify(cfg.nodemon, null, '  '), 'utf-8')\n  fs.writeFileSync(`${cfg.runtime.cacheDir}/full-config-dump.json`, JSON.stringify(cfg, null, '  '), 'utf-8')\n  fs.writeFileSync(`${cfg.runtime.cacheDir}/browsersync.config.js`, `module.exports = require(\"${cfg.runtime.lanyonDir}/lib/config.js\").browsersync`, 'utf-8')\n  fs.writeFileSync(`${cfg.runtime.cacheDir}/webpack.config.js`, `module.exports = require(\"${cfg.runtime.lanyonDir}/lib/config.js\").webpack`, 'utf-8')\n  fs.writeFileSync(cfg.runtime.recordsPath, JSON.stringify({}, null, '  '), 'utf-8')\n\n  let dBuf = stripIndent`\n    FROM ruby:2.3.3-alpine\n    RUN mkdir -p /jekyll\n    WORKDIR /jekyll\n    COPY Gemfile /jekyll/\n    COPY Gemfile.lock /jekyll/\n    RUN true \\\\\n      && apk --update add make gcc g++ \\\\\n      && (bundler install --force --path /jekyll/vendor/bundler || bundler update) \\\\\n      && apk del make gcc g++ \\\\\n      && rm -rf /var/cache/apk/* \\\\\n      && true\n  `\n  fs.writeFileSync(`${cfg.runtime.cacheDir}/Dockerfile`, dBuf, 'utf-8')\n\n  let gBuf = `source 'http://rubygems.org'\\n`\n  for (let name in cfg.runtime.gems) {\n    gBuf += `gem '${name}', '${cfg.runtime.gems[name]}'\\n`\n  }\n  fs.writeFileSync(path.join(cfg.runtime.cacheDir, 'Gemfile'), gBuf, 'utf-8')\n}\n\nmodule.exports.satisfied = ({prerequisites, rubyProvidersSkip}, app, cmd, checkOn) => {\n  let tag = ''\n  if (checkOn === undefined) {\n    checkOn = app\n  } else {\n    tag = `${checkOn}/`\n  }\n\n  if (rubyProvidersSkip.indexOf(checkOn) !== -1) {\n    scrolex.failure(`${tag}${app} '${prerequisites[app].range} disabled via LANYON_SKIP`)\n    return false\n  }\n\n  if (!cmd) {\n    cmd = `${app} -v`\n  }\n\n  const p              = shell.exec(cmd, { 'silent': true })\n  const appVersionFull = p.stdout.trim() || p.stderr.trim()\n  const parts          = appVersionFull.replace(/0+(\\d)/g, '$1').split(/[,p\\s-]+/)\n  let appVersion       = parts[1]\n\n  if (app === 'node') {\n    appVersion = parts[0]\n  } else if (app === 'bundler') {\n    appVersion = parts[2]\n  } else if (app === 'docker') {\n    appVersion = parts[2]\n  }\n\n  try {\n    if (semver.satisfies(appVersion, prerequisites[app].range)) {\n      scrolex.stick(`${tag}${app} '${prerequisites[app].range} available`)\n      return true\n    }\n  } catch (e) {\n    scrolex.failure(`${tag}${app} '${prerequisites[app].range} unavailable. output: ${appVersionFull}. ${e}`)\n    return false\n  }\n\n  scrolex.failure(`${tag}${app} '${prerequisites[app].range} unavailable. output: ${appVersionFull}`)\n  return false\n}\n"]}